<br>
<div class="container-fluid">
  <div class="row align-items-center">
    <div class="col-8">
      <h2>タイトル: {{ space?.title }}</h2>
    </div>
    <div class="col-4 text-end">
      <button class="btn btn-outline-primary btn-lg px-4 fw-bold shadow-sm"
       (click)="goParentIShare()">
       このスペースを閉じる<i class="fa fa-sign-out-alt ms-2"></i>
      </button>
    </div>
    <div class="col-12">
      <h6>スペースの説明： {{ space?.description }}</h6>
    </div>
  </div>
</div>
<hr>

<!-- コメントリスト表示 -->
<div class="container-fluid" style="padding-top: 10px; padding-bottom: 15em; overflow-y: auto;">
  <div class="row" *ngFor="let comment of comments; let i = index">
    <div class="col-12">
      <div class="card my-2">
        <div class="card-header d-flex align-items-center">
          <span class="badge bg-primary me-2">{{ i + 1 }}</span>
          <strong>{{ comment.user }}</strong>
          <span class="text-muted ms-2">{{ comment.date | date:'yyyy/MM/dd HH:mm' }}</span>
          <div class="ms-auto">
            <button class="btn btn-sm btn-warning me-2" (click)="onEditComment(comment)">編集</button>
            <button class="btn btn-sm btn-danger" (click)="onDeleteComment(comment)">削除</button>
          </div>
        </div>
        <div class="card-body">
          <div style="white-space: pre-wrap;">{{ comment.text }}</div>
          <div *ngIf="comment.fileName">
            <i class="fa fa-paperclip"></i>
            <span *ngIf="comment.fileUrl; else noLink">
              <a *ngIf="comment.fileUrl" [href]="comment.fileUrl" target="_blank">
                {{ comment.fileName }} をダウンロード
              </a>
            </span>
            <ng-template #noLink>
              {{ comment.fileName }}
            </ng-template>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- 入力エリアを画面下部に固定 -->
<div 
  class="container-fluid"
  style="position: fixed; bottom: 0; left: 0; width: 100%; background: #fff; z-index: 9999; box-shadow: 0 -2px 8px rgba(0,0,0,0.05);
         padding-top: 0.5rem; padding-bottom: 0.5rem;">
  <div class="row align-items-center">
    <div class="col-8">
      <textarea class="form-control" placeholder="コメントを入力してください" 
        rows="2" style="resize: vertical; min-height: 10em; max-height: 10em;"
        [(ngModel)]="commentText"></textarea>
    </div>
    <div class="col-2 text-center" style="position: relative;">
      <label 
        class="btn btn-secondary w-100 mb-0"
        (mouseenter)="showPopover = true"
        (mouseleave)="showPopover = false"
        [title]="fileName || 'ファイルを選択してください'" 
        style="position: relative;"
      >
        <i class="fa fa-paperclip"></i> ファイル添付
        <input 
          type="file" 
          style="display: none;" 
          (change)="onFileSelected($event)"
        >
      </label>
      <!-- ポップアップ（ファイル選択時のみ表示） -->
      <div 
        *ngIf="showPopover && fileName"
        class="popover bs-popover-top show"
        style="position: absolute; left: 50%; transform: translateX(-50%); bottom: 110%; z-index: 1000; min-width: 180px;"
        (mouseenter)="showPopover = true"
        (mouseleave)="showPopover = false"
      >
        <div class="popover-arrow" style="left: 50%;"></div>
        <div class="popover-body text-center">
          <div>{{ fileName }}</div>
          <button class="btn btn-danger btn-sm mt-2" (click)="onFileRemove()">削除</button>
        </div>
      </div>
    </div>
    <div class="col-1 text-center">
      <button class="btn btn-primary w-100" style="height: 100%;" (click)="onSend()">
        <i class="fa fa-paper-plane"></i>
      </button>
    </div>
  </div>
</div>